function addPO(e){$.post(reroute+"/addProductToPO",{id:e},function(t){$("#productId"+e).length?$("#prodError1").fadeIn("fast",function(){$("#prodError1").fadeOut(4e3)}):($(".POtable").append('<tr id="PO'+itemno+'"><td id="itemno'+itemno+'">'+itemno+'</td><td id="productId'+e+'">'+e+"</td>\n						<td>"+t.ProductName+"</td><td>"+t.BrandName+"</td><td>"+t.WholeSaleUnit+'</td>\n						<td class="light-green editable dp" id="prodQty'+e+'">'+money(1)+'</td><td class="light-red editable dp" id="prodUnit'+e+'">1.00</td>\n						<td class="cost dp" id="prodCost'+e+'">0.00</td><td >\n						<button class="btn btn-danger btn-xs square" id="removePO'+itemno+'" onclick="removePO('+itemno+')">\n						<i class="fa fa-times"></i> Remove</button></td></tr>'),itemno+=1,$(".editable").editable({send:"never",type:"text",value:1,validate:function(e){return""==$.trim(e)?"This field is required":""==$.isNumeric(e)||0==e?"Please input a valid number greater than 0":void 0},emptytext:0,display:function(t){$(this).text(money(t)),calcCost(e)}}),$("#savePO").removeClass("hidden"))})}function calcCost(e){var t=$("#prodQty"+e).text(),a=$("#prodUnit"+e).text();$("#prodCost"+e).text(money(t*a)),totalCost()}function totalCost(){var e=0;$(".cost").each(function(){e+=parseFloat($(this).text())}),$("#POTotalCost").text(money(e)),(e=0)&&$("#savePO").addClass("hidden")}function removePO(e){if($("#PO"+e).remove(),e+=1,$("#PO"+e).length)for(;itemno>e;)$("#PO"+e).attr("id","PO"+(e-1)),$("#itemno"+e).attr("id","itemno"+(e-1)),$("#itemno"+(e-1)).text(e-1),$("#removePO"+e).attr("id","removePO"+(e-1)),$("#removePO"+(e-1)).attr("onclick","removePO("+(e-1)+")"),e++;itemno-=1,totalCost()}function viewPO(e){$("#viewPOModal").modal("show"),$.post(reroute+"/viewPO",{id:e},function(e){$("#vwPOId").text(e[0].id),$("#vwPODate").text(e[0].PODate),$("#vwSupplier").val(e[0].SupplierNo),"0"==e[0].Terms?$("#vwTerm").val("Cash"):$("#vwTerm").val(e[0].Terms),$("#vwPreparedBy").val(e[0].PreparedBy),""==e[0].ApprovedBy?$("#vwApprovedBy").val("N/A"):$("#vwApprovedBy").val(e[0].ApprovedBy),$("#vwCancelMsg").attr("class","alert"),1==e[0].IsCancelled?($("#vwCancelMsg").addClass("alert-danger"),$("#vwCancelMsg").text("This PO has been cancelled by "+e[0].CancelledBy)):""!=e[0].ApprovedBy&&($("#vwCancelMsg").addClass("alert-success"),$("#vwCancelMsg").text("This PO has been approved by "+e[0].ApprovedBy))}),$.post(reroute+"/viewPODetails",{id:e},function(e){$(".vwPOTable > tbody").html(""),counter=1;var t=0;$.each(e,function(e,a){$(".vwPOTable >tbody").append("<tr ><td>"+counter+"</td><td>"+a.ProductNo+"</td>\n	  					<td>"+a.ProductName+"</td>\n	  					<td>"+a.BrandName+"</td><td >"+a.Unit+'</td><td class="dp">'+Number(a.Qty).toFixed(0)+'</td><td class="dp">'+Number(a.CostPerQty).toFixed(2)+'</td>\n	  					<td class="dp">'+a.CostPerQty*a.Qty+"</td></tr>"),counter+=1,t+=a.CostPerQty*a.Qty}),$("#vwTotalCost").text(Number(t).toFixed(2))})}function editPO(e){$("#vwSavePOBtn").addClass("hidden"),$("#editPOModal").modal("show"),$.post(reroute+"/viewPO",{id:e},function(e){$("#edPOId").text(e[0].id),$("#edPODate").text(e[0].PODate),$('[name="vwSupplier"]').val(e[0].SupplierNo),"0"==e[0].Terms?($("#edTerm").val(0),$("#edTerm1").addClass("active"),$("#edTerm2").removeClass("active"),$("#edTermBox").addClass("hidden")):($("#edTerm").val(e[0].Terms),$("#edTerm1").removeClass("active"),$("#edTerm2").addClass("active"),$("#edTerm2").prop("disabled",!1),$("#edTermBox").removeClass("hidden")),$("#edPreparedBy").val(e[0].PreparedBy),""==e[0].ApprovedBy?($("#edApprovedBy").val("N/A"),$("#vwApproved").prop("checked",!1)):($("#edApprovedBy").val(e[0].ApprovedBy),$("#vwApproved").prop("checked",!0),"Bills"==document.title&&$("#vwApproved").prop("disabled",!0))}),$.post(reroute+"/viewPODetails",{id:e},function(e){$(".edPOTable > tbody").html(""),counter=1;var t=0;$.each(e,function(e,a){$(".edPOTable >tbody").append('<tr id="vwPO'+counter+'"><td id="vwItemno'+counter+'">'+counter+'</td><td id="vwProd'+a.ProductNo+'">'+a.ProductNo+"</td>\n	  					<td>"+a.ProductName+"</td>\n	  					<td>"+a.BrandName+"</td><td>"+a.Unit+'</td><td class="vweditable dp" id="edQty'+a.ProductNo+'">'+a.Qty+'</td><td class="vweditable dp" id="edUnit'+a.ProductNo+'">'+Number(a.CostPerQty).toFixed(2)+'</td>\n	  					<td class="ecost dp"id="edCost'+a.ProductNo+'">'+Number(a.CostPerQty).toFixed(2)+'</td><td><button class="btn btn-danger \n	  					btn-xs square dis" id="vwRemovePO'+counter+'" onclick="vwRemovePO('+counter+')" >\n						<i class="fa fa-times" ></i> Remove</button></td></tr>'),t+=a.CostPerQty*a.Qty,editable(a.ProductNo),counter+=1}),$("#edPOTotalCost").text(Number(t).toFixed(2))})}function billPO(e){$("#saveBillPOBtn,#billApprove").removeClass("hidden"),$("#vwSaveBillBtn,#BillCancelBtn,#checkAlert,#billApproved").addClass("hidden"),$("#billNo").text("New Bill"),$("#billPOModal").modal("show"),$.post(reroute+"/viewPO",{id:e},function(e){$("#billPOId").text(e[0].id),$('[name="billPOSupplier"]').val(e[0].SupplierNo),$("#billBranchName").val(e[0].BranchName),"0"==e[0].Terms?($("#billTerm").val(0),$("#billTerm1").addClass("active"),$("#billTerm2").removeClass("active"),$("#billTermBox").addClass("hidden")):($("#billTerm").val(e[0].Terms),$("#billTerm1").removeClass("active"),$("#billTerm2").addClass("active"),$("#billTerm2").prop("disabled",!1),$("#billTermBox").removeClass("hidden"))}),$.post(reroute+"/viewPODetails",{id:e},function(e){$(".BillPOTable > tbody").html(""),counter=1;var t=0;$.each(e,function(e,a){$(".BillPOTable >tbody").append('<tr id="billPO'+counter+'" class="billRow"><td >'+counter+"</td><td>"+a.ProductNo+"</td>\n	  					<td>"+a.ProductName+"</td>\n	  					<td>"+a.BrandName+"</td><td>"+a.Unit+'</td><td class="numberEditable danger"></td><td class="danger dateEditable">'+(d.getFullYear()+1)+'-01-01</td><td class="dp" >'+a.Qty+'</td><td class="dp" >'+Number(a.CostPerQty).toFixed(2)+'</td>\n	  					<td class="dp success">'+Number(a.CostPerQty*a.Qty).toFixed(2)+'</td><td class="vweditable dp danger">0</td><td class="danger selectEditable dp"></td></tr>'),t+=a.CostPerQty*a.Qty,editable(a.ProductNo),editableNumber(a.ProductNo),editableSelect(a.ProductNo,a.RetailUnit,a.WholeSaleUnit),dateEditable(a.ProductNo),counter+=1}),$("#billPOTotalCost").text(Number(t).toFixed(2))})}function editBill(e){$("#saveBillPOBtn,#vwSaveBillBtn,#billApprove").addClass("hidden"),$("#BillCancelBtn,#checkAlert,#billApproved,#vwSaveBillBtn").removeClass("hidden"),$("#vwSaveBillBtn").val(e),$("#billPOModal").modal("show"),$("#billNo").text("Bill No. "+e),$.post(reroute+"/viewBill",{id:e},function(e){$("#billPOId").text(e[0].PurchaseOrderNo),$('[name="billPOSupplier"]').val(e[0].SupplierNo),$("#billBranchName").val(e[0].BranchName),"0"==e[0].Terms?($("#billTerm").val(0),$("#billTerm1").addClass("active"),$("#billTerm2").removeClass("active"),$("#billTermBox").addClass("hidden")):($("#billTerm").val(e[0].Terms),$("#billTerm1").removeClass("active"),$("#billTerm2").addClass("active"),$("#billTerm2").prop("disabled",!1),$("#billTermBox").removeClass("hidden")),""==e[0].ApprovedBy?$("#billApproved").prop("checked",!1):$("#billApproved").prop("checked",!0);var t=new Date(e[0].SalesInvoiceDate);$("#invoicedate").val(t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()),$("#invoiceno").val(e[0].SalesInvoiceNo)}),$.post(reroute+"/viewBillDetails",{id:e},function(e){$(".BillPOTable > tbody").html(""),counter=1;var t=0;$.each(e,function(e,a){$(".BillPOTable >tbody").append('<tr id="billPO'+counter+'" ><td >'+counter+"</td><td>"+a.ProductNo+"</td>\n	  					<td>"+a.ProductName+"</td>\n	  					<td>"+a.BrandName+"</td><td>"+a.Unit+'</td><td class="numberEditable danger">'+a.LotNo+'</td><td class="danger dateEditable">'+a.ExpiryDate+'</td><td class="dp" >'+a.Qty+'</td><td class="dp" >'+Number(a.Cost).toFixed(2)+'</td>\n	  					<td class="dp success">'+Number(a.Cost*a.Qty).toFixed(2)+'</td><td class="vweditable dp danger">'+a.FreebiesQty+'</td><td class="danger selectEditable dp">'+a.FreebiesUnit+"</td></tr>"),t+=a.Cost*a.Qty,editable(a.ProductNo),editableNumber(a.ProductNo),editableSelect(a.ProductNo,a.RetailUnit,a.WholeSaleUnit),dateEditable(a.ProductNo),counter+=1}),$("#billPOTotalCost").text(Number(t).toFixed(2))})}function viewBill(e){$("#viewBillModal").modal("show"),$("#vwbillNo").text(e),$.post(reroute+"/viewBill",{id:e},function(e){$("#vwbillPOId").text(e[0].PurchaseOrderNo),$('[name="vwBillSupplier"]').val(e[0].SupplierNo),$("#vwBillBranchName").val(e[0].BranchName),"0"==e[0].Terms?$("#vwBillTerm").val("Cash"):$("#vwBillTerm").val(e[0].Terms),$("#billDate").text(e[0].BillDate);var t=new Date(e[0].SalesInvoiceDate);$("#vwBillInvoiceDate").val(t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()),$("#vwBillInvoiceNo").val(e[0].SalesInvoiceNo)}),$.post(reroute+"/viewBillDetails",{id:e},function(e){$(".BillPOTable2 > tbody").html(""),counter=1;var t=0;$.each(e,function(e,a){$(".BillPOTable2 >tbody").append("<tr ><td >"+counter+"</td><td>"+a.ProductNo+"</td>\n	  					<td>"+a.ProductName+"</td>\n	  					<td>"+a.BrandName+"</td><td>"+a.Unit+"</td><td >"+a.LotNo+"</td><td >"+a.ExpiryDate+'</td><td class="dp" >'+a.Qty+'</td><td class="dp" >'+Number(a.Cost).toFixed(2)+'</td>\n	  					<td class="dp success">'+Number(a.Cost*a.Qty).toFixed(2)+'</td><td class="dp ">'+a.FreebiesQty+'</td><td class="dp">'+a.FreebiesUnit+"</td></tr>"),t+=a.Cost*a.Qty,counter+=1}),$("#vwBillTotalCost").text(Number(t).toFixed(2))})}function billSO(e){$("#saveBillSOBtn,#billApprove").removeClass("hidden"),$("#vwSaveBillBtn,#SICancelBtn,#checkAlert,#SIApproved").addClass("hidden"),$("#billNo").text("New Invoice"),$("#billSOModal").modal("show"),$.post(reroute+"/viewSO",{id:e},function(e){$("#billSOId").text(e[0].id),$('[name="billSOCustomers"]').val(e[0].CustomerNo),$('[name="billSOmedReps"]').val(e[0].UserNo),"0"==e[0].Terms?($("#billTerm").val(0),$("#billTerm1").addClass("active"),$("#billTerm2").removeClass("active"),$("#billTermBox").addClass("hidden")):($("#billTerm").val(e[0].Terms),$("#billTerm1").removeClass("active"),$("#billTerm2").addClass("active"),$("#billTerm2").prop("disabled",!1),$("#billTermBox").removeClass("hidden"))}),$.post(reroute+"/viewSODetails",{id:e},function(e){$(".BillSOTable > tbody").html(""),counter=1;var t=0;$.each(e,function(e,a){$(".BillSOTable >tbody").append('<tr id="billSO'+counter+'" class="billRow"><td >'+counter+"</td><td>"+a.ProductNo+"</td>\n	  					<td>"+a.ProductName+"</td>\n	  					<td>"+a.BrandName+"</td><td>"+a.Unit+"</td><td >"+a.LotNo+"</td><td >"+a.ExpiryDate+'-01-01</td><td class="dp" >'+a.Qty+'</td><td class="dp" >'+Number(a.UnitPrice).toFixed(2)+'</td>\n	  					<td class="dp success">'+Number(a.UnitPrice*a.Qty).toFixed(2)+'</td><td class="numberEditable dp danger">0</td><td class="danger selectEditable dp"></td></tr>'),t+=a.UnitPrice*a.Qty,editableNumber(a.ProductNo),editableSelect(a.ProductNo,a.RetailUnit,a.WholeSaleUnit),counter+=1}),$("#billSOTotalCost").text(Number(t).toFixed(2))})}function editSI(e){$("#saveBillSOBtn,#vwSaveBillBtn,#billApprove").addClass("hidden"),$("#SICancelBtn,#checkAlert,#SIApproved,#vwSaveSIBtn").removeClass("hidden"),$("#vwSaveSIBtn").val(e),$("#billSOModal").modal("show"),$("#billNo").text("Invoice No. "+e),$.post(reroute+"/viewSI",{id:e},function(e){$("#billSOId").text(e.SalesOrderNo),$('[name="billSOCustomers"]').val(e.CustomerNo),$('[name="billSOmedReps"]').val(e.UserNo),"0"==e.Terms?($("#billTerm").val(0),$("#billTerm1").addClass("active"),$("#billTerm2").removeClass("active"),$("#billTermBox").addClass("hidden")):($("#billTerm").val(e.Terms),$("#billTerm1").removeClass("active"),$("#billTerm2").addClass("active"),$("#billTerm2").prop("disabled",!1),$("#billTermBox").removeClass("hidden")),""==e.ApprovedBy?$("#SIApproved").prop("checked",!1):$("#SIApproved").prop("checked",!0);var t=new Date(e.InvoiceDate);$("#invoicedate").val(t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()),$("#invoiceno").val(e.SalesInvoiceRefDocNo)}),$.post(reroute+"/viewSIDetails",{id:e},function(e){$(".BillSOTable > tbody").html(""),counter=1;var t=0;$.each(e,function(e,a){$(".BillSOTable >tbody").append('<tr id="billSO'+counter+'" class="billRow"><td >'+counter+"</td><td>"+a.ProductNo+"</td>\n	  					<td>"+a.ProductName+"</td>\n	  					<td>"+a.BrandName+"</td><td>"+a.Unit+"</td><td >"+a.LotNo+"</td><td >"+a.ExpiryDate+'-01-01</td><td class="dp" >'+a.Qty+'</td><td class="dp" >'+Number(a.UnitPrice).toFixed(2)+'</td>\n	  					<td class="dp success">'+Number(a.UnitPrice*a.Qty).toFixed(2)+'</td><td class="numberEditable dp danger">'+a.FreebiesQty+'</td><td class="danger selectEditable dp">'+a.FreebiesUnit+"</td></tr>"),t+=a.UnitPrice*a.Qty,editableNumber(a.ProductNo),a.FreebiesUnit==a.RetailUnit?editableSelect(a.ProductNo,a.RetailUnit,a.WholeSaleUnit):a.FreebiesUnit==a.WholeSaleUnit&&editableSelect(a.ProductNo,a.WholeSaleUnit,a.RetailUnit),counter+=1}),$("#billSOTotalCost").text(Number(t).toFixed(2))})}function viewSI(e){$("#viewSIModal").modal("show"),$("#vwbillNo").text(e),$.post(reroute+"/viewSI",{id:e},function(e){$("#vwbillSOId").text(e.SalesOrderNo),$('[name="vwbillSOCustomers"]').val(e.CustomerNo),$('[name="vwbillSOmedReps"]').val(e.UserNo),"0"==e.Terms?$("#vwBillTerm").val("Cash"):$("#vwBillTerm").val(e.Terms),$("#billDate").text(e.created_at);var t=new Date(e.InvoiceDate);$("#vwBillInvoiceDate").val(t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()),$("#vwBillInvoiceNo").val(e.SalesInvoiceRefDocNo)}),$.post(reroute+"/viewSIDetails",{id:e},function(e){$(".BillSOTable2 > tbody").html(""),counter=1;var t=0;$.each(e,function(e,a){$(".BillSOTable2 >tbody").append('<tr id="billSO'+counter+'" class="billRow"><td >'+counter+"</td><td>"+a.ProductNo+"</td>\n	  					<td>"+a.ProductName+"</td>\n	  					<td>"+a.BrandName+"</td><td>"+a.Unit+"</td><td >"+a.LotNo+"</td><td >"+a.ExpiryDate+'-01-01</td><td class="dp" >'+a.Qty+'</td><td class="dp" >'+Number(a.UnitPrice).toFixed(2)+'</td>\n	  					<td class="dp success">'+Number(a.UnitPrice*a.Qty).toFixed(2)+'</td><td class="numberEditable dp danger">'+a.FreebiesQty+'</td><td class="danger selectEditable dp">'+a.FreebiesUnit+"</td></tr>"),t+=a.UnitPrice*a.Qty,counter+=1}),$("#vwBillTotalCost").text(Number(t).toFixed(2))})}function editable(e){$(".vweditable").editable({send:"never",type:"text",validate:function(e){return""==$.trim(e)?"This field is required":""==$.isNumeric(e)||0==e?"Please input a valid number greater than 0":void 0},emptytext:0,display:function(t){$(this).text(Number(t).toFixed(2)),edcalcCost(e)}})}function editableNumber(){$(".numberEditable").editable({send:"never",type:"text",emptytext:0,validate:function(e){return""==$.trim(e)?"This field is required":""==$.isNumeric(e)||0==e?"Please input a valid number greater than 0":void 0},display:function(e){$(this).text(e)}})}function editableSelect(e,t,a){$(".selectEditable").editable({value:1,type:"select",validate:function(e){return""==$.trim(e)?"This field is required":void 0},source:[{value:1,text:t},{value:2,text:a}]})}function dateEditable(){$(".dateEditable").editable({type:"combodate",format:"YYYY-MM-DD",viewformat:"YYYY-MM-DD",template:"D / MMMM / YYYY",validate:function(e){return""==$.trim(e)?"This field is required":void 0},combodate:{minYear:d.getFullYear(),maxYear:d.getFullYear()+10,minuteStep:1}})}function edcalcCost(e){var t=$("#edQty"+e).text(),a=$("#edUnit"+e).text();$("#edCost"+e).text(Number(t*a).toFixed(2)),edtotalCost()}function edtotalCost(){var e=0;$(".ecost").each(function(){e+=parseFloat($(this).text())}),$("#edPOTotalCost").text(Number(e).toFixed(2)),0==e&&$("#vwSavePOBtn").addClass("hidden")}function vwaddPO(e){{var t=$("#vwname"+e).text(),a=$("#vwbrand"+e).text(),l=$("#vwunit"+e).text(),d=$(".vwproduct").DataTable();d.row("#vwrowProd"+e).index()}$("#vwProd"+e).length?$("#prodError").fadeIn("fast",function(){$("#prodError").fadeOut(4e3)}):($(".edPOTable >tbody").append('<tr id="vwPO'+counter+'"><td id="vwItemno'+counter+'">'+counter+'</td><td id="vwProd'+e+'">'+e+"</td>\n	  					<td>"+t+"</td>\n	  					<td>"+a+"</td><td>"+l+'</td><td class="vweditable dp" id="edQty'+e+'">'+Number(1).toFixed(2)+'</td><td class="vweditable dp" id="edUnit'+e+'">'+Number(1).toFixed(2)+'</td>\n	  					<td class="ecost dp"id="edCost'+e+'">0.00</td><td><button class="btn btn-danger \n	  					btn-xs square dis" id="vwRemovePO'+counter+'" onclick="vwRemovePO('+counter+')" >\n						<i class="fa fa-times" ></i> Remove</button></td></tr>'),counter+=1,editable(e),$("#vwSavePOBtn").removeClass("hidden"))}function vwRemovePO(e){if($("#vwPO"+e).remove(),e+=1,$("#vwPO"+e).length)for(;$("#vwPO"+e).length;)$("#vwPO"+e).attr("id","vwPO"+(e-1)),$("#vwItemno"+e).attr("id","vwItemno"+(e-1)),$("#vwItemno"+(e-1)).text(e-1),$("#vwRemovePO"+e).attr("id","vwRemovePO"+(e-1)),$("#vwRemovePO"+(e-1)).attr("onclick","vwRemovePO("+(e-1)+")"),e++;counter-=1,edtotalCost(),$("#vwSavePOBtn").removeClass("hidden")}function triggerEdit(e){$.post(reroute+"/toEditBank",{id:e},function(t){t&&($(".alert").remove(),$("#library-action").val(t.id),$(".name").val(t.BankName),$(".address").val(t.BAddress),$(".telephone").val(t.Telephone),$(".deactivate").attr("href","/delete-bank/"+e),$(".delete").show())}),$("#bank-library").modal("show")}function triggerEditBranch(e){$.post(reroute+"/toEditBranch",{id:e},function(t){t&&($(".alert").remove(),$("#library-action").val(t.id),$(".name").val(t.BranchName),$(".address").val(t.BAddress),$(".telephone").val(t.Telephone),$(".deactivate").attr("href","/delete-branch/"+e),$(".delete").show())}),$("#branch-library").modal("show")}function triggerEditCustomer(e){$.post(reroute+"/toEditCustomer",{id:e},function(t){t&&($(".alert").remove(),$("#library-action").val(t.id),$(".name").val(t.CustomerName),$(".address").val(t.Address),$(".telephone1").val(t.Telephone1),$(".telephone2").val(t.Telephone2),$(".contact-person").val(t.ContactPerson),$(".credit-limit").val(t.CreditLimit),$(".deactivate").attr("href","/delete-customer/"+e),$(".delete").show())}),$("#customer-library").modal("show")}function triggerEditUser(e){$.post(reroute+"/toEditUser",{id:e},function(t){t&&($(".alert").remove(),$('select#usertype option[value="'+t.UserType+'"]').attr("selected",!0),$('select#branches option[value="'+t.BranchNo+'"]').attr("selected",!0),$("#library-action").val(t.id),$(".username").val(t.username),$(".lastname").val(t.Lastname),$(".firstname").val(t.Firstname),$(".mi").val(t.MI),$(".usertype").val(t.UserType),$(".deactivate").attr("href","/delete-user/"+e),$(".delete").show())}),$(".user-pwd").hide(),$(".password,.retype-password").removeAttr("required"),$("#user-library").modal("show")}function money(e){return Number(e).toFixed(2)}function numberWithCommas(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function addBillToPayment(e){$.post(reroute+"/addBillToPayment",{id:e},function(t){if($("#billId"+e).length)$("#billError1").fadeIn("fast",function(){$("#billError1").fadeOut(4e3)});else{if($("#bill1").length&&!$(".supplier"+t[0].SupplierNo).length)return $("#billSupError1").fadeIn("fast",function(){$("#billSupError1").fadeOut(4e3)}),void 0;$(".BillPaymentTable").append('<tr id="bill'+itemno+'"><td id="billitemno'+itemno+'">'+itemno+'</td><td id="billId'+e+'">'+e+'</td>\n							<td class="supplier'+t[0].SupplierNo+'">'+t[0].SupplierName+'<td class="dp">'+t[0].SalesInvoiceNo+'</td><td class="dp Billcost">'+money(t.amount)+'</td><td>\n							<button class="btn btn-danger btn-xs square" id="removeBill'+itemno+'" onclick="removeBill('+itemno+')">\n							<i class="fa fa-times"></i> Remove</button></td></tr>'),itemno+=1,calcBillPaymentTotal(),$("#saveBill,.cashChecque").removeClass("hidden")}})}function removeBill(e){if($("#bill"+e).remove(),e+=1,$("#bill"+e).length)for(;itemno>e;)$("#bill"+e).attr("id","bill"+(e-1)),$("#billitemno"+e).attr("id","itemno"+(e-1)),$("#billitemno"+(e-1)).text(e-1),$("#removeBill"+e).attr("id","removeBill"+(e-1)),$("#removeBill"+(e-1)).attr("onclick","removeBill("+(e-1)+")"),e++;itemno-=1,calcBillPaymentTotal()}function calcBillPaymentTotal(){var e=0,t=0;$(".Balcost").text()&&(t=parseFloat($(".Balcost").text())),$(".Billcost").each(function(){e+=parseFloat($(this).text())}),$("#BillPaymentTotalCost").text(money(e+t)),0==e&&($("#BillPaymentTotalCost").text(money(e)),$("#invoicesTfoot").remove(),$("#saveBill,.cashChecque,#saveSP").addClass("hidden"))}function addSItoSP(e){$.post(reroute+"/addInvoiceToSalesPayment",{id:e},function(t){if($("#billId"+e).length)$("#billError1").fadeIn("fast",function(){$("#billError1").fadeOut(4e3)});else{if($("#bill1").length){if(!$(".customer"+t.CustomerNo).length)return $("#billSupError1").fadeIn("fast",function(){$("#billSupError1").fadeOut(4e3)}),void 0}else{$("#cashCheckTable > tbody").remove(),PTcalcCost(),$("#customer_id").val(t.CustomerNo);var a=t.BranchNo;$("#SPediting").val()&&$("#customer_id").val()==t.CustomerNo?$.post(reroute+"/getBal",{id:$("#SPediting").val()},function(e){0>e?$(".BillPaymentTable").append('<tfoot id="invoicesTfoot"><tr><td colspan="5"></td><td class="dp Balcost">'+money(-1*e)+"</td><td>Advanced Payment</td></tr></tfoot>"):e>0&&$(".BillPaymentTable").append('<tfoot id="invoicesTfoot"><tr><td colspan="5"></td><td class="dp Balcost">'+money(-1*e)+"</td><td>Balance</td></tr></tfoot>"),calcBillPaymentTotal()}):$.post(reroute+"/checkPayments",{customer_id:t.CustomerNo,branch:a},function(e){e>0?($(".BillPaymentTable").append('<tfoot id="invoicesTfoot"><tr><td colspan="5"></td><td class="dp Balcost">'+money(e)+"</td><td>Balance</td></tr></tfoot>"),calcBillPaymentTotal()):0>e&&($(".BillPaymentTable").append('<tfoot id="invoicesTfoot"><tr><td colspan="5"></td><td class="dp Balcost">'+money(e)+"</td><td>Advanced Payment</td></tr></tfoot>"),calcBillPaymentTotal()),PTcalcCost()})}$(".BillPaymentTable").append('<tr id="bill'+itemno+'"><td id="billitemno'+itemno+'">'+itemno+'</td><td id="billId'+e+'">'+e+'</td>\n							<td class="customer'+t.CustomerNo+'">'+t.CustomerName+'</td><td class="medrep'+t.UserNo+'">'+t.Lastname+", "+t.Firstname+" "+t.MI+'.<td class="dp">'+t.SalesInvoiceRefDocNo+'</td><td class="dp Billcost">'+money(t.amount)+'</td>\n							<td><button class="btn btn-danger btn-xs square" id="removeBill'+itemno+'" onclick="removeBill('+itemno+')">\n							<i class="fa fa-times"></i> Remove</button></td></tr>'),itemno+=1,calcBillPaymentTotal(),$("#saveSP,.cashChecque").removeClass("hidden")}})}function viewSP(e){$("#viewSPModal").modal("show"),$("#vwbillNo").text(e),$.post(reroute+"/viewSP",{id:e},function(e){$("#vwbillNo").text(e.id),$('[name="vwbillSPBranch"]').val(e.BranchNo),$("#vwSPPreparedBy").val(e.PreparedBy),$("#vwSPApprovedBy").val(e.ApprovedBy);var t=new Date(e.PaymentDate);$("#paymentDate").text(t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear())});var t=1;$(".BillSPTable > tbody").remove(),$("#balTFoot").remove(),$.post(reroute+"/getSPInvoices",{id:e},function(e){$.each(e,function(e,a){$(".BillSPTable").append("<tr ><td>"+t+'</td><td id="billId'+a.invoiceNo+'">'+a.invoiceNo+'</td>\n				<td class="customer'+a.CustomerNo+'">'+a.CustomerName+'</td><td class="medrep'+a.UserNo+'">'+a.Lastname+", "+a.Firstname+" "+a.MI+'.<td class="dp">'+a.SalesInvoiceRefDocNo+'</td><td class="dp vwBillcost">'+money(a.amount)+"</td>\n				</tr>"),t+=1,$("#billSPCustomers").val(a.CustomerNo),vwBillcalcCost()})}),$(".BillSPPaymentType > tbody").remove(),$.post(reroute+"/getPaymentTypes",{id:e},function(e){if(e.length){var t=0;$.each(e,function(e,a){0==a.PaymentType&&$(".BillSPPaymentType").append('<tr >\n						<td colspan="4">Cash</td>\n						<td >'+money(a.amount)+"</td></tr>"),1==a.PaymentType&&$(".BillSPPaymentType").append("<tr >\n						<td>Check</td>\n						<td>"+a.BankName+"</td>\n						<td >"+a.CheckNo+"</td>\n						<td >"+a.CheckDueDate+"</td>\n						<td >"+money(a.amount)+"</td>\n						</tr>"),t+=parseFloat(a.amount),$("#pTTotal").text(money(t))})}}),$.post(reroute+"/getBal",{id:e},function(e){0>e?$(".BillSPTable").append('<tfoot id="balTFoot"><tr><td colspan="5" class="dp">Balance</td><td class="dp vwBillcost">'+money(-1*e)+"</td></tr></tfoot>"):e>0&&$(".BillSPTable").append('<tfoot id="balTFoot"><tr><td colspan="5" class="dp">Advance</td><td class="dp vwBillcost">'+money(-1*e)+"</td></tr></tfoot>"),vwBillcalcCost()})}function addPaymentType(){var e=$("#paymentType").val();0==e&&$("#cashCheckTable").append('<tr id="PT'+paymentItem+'">\n			<td colspan="4">Cash</td>\n			<td class="PTeditable danger PTcost">'+($("#BillPaymentTotalCost").text()-$("#paymentTypeTotal").text())+'</td>\n			<td><button class="btn btn-danger btn-xs square" id="removePT'+paymentItem+'" onclick="removePT('+paymentItem+')">\n			<i class="fa fa-times"></i> Remove</button></td></tr>'),1==e&&($("#cashCheckTable").append('<tr id="PT'+paymentItem+'">\n			<td>Check</td>\n			<td><select class="bankSelect form-control square"></select></td><td class="numberEditable danger"></td>\n			<td class="dateEditable danger">'+(d.getFullYear()+1)+'-01-01</td>\n			<td class="PTeditable danger PTcost">'+($("#BillPaymentTotalCost").text()-$("#paymentTypeTotal").text())+'</td>\n			<td><button class="btn btn-danger btn-xs square" id="removePT'+paymentItem+'" onclick="removePT('+paymentItem+')">\n			<i class="fa fa-times"></i> Remove</button></td></tr>'),$.post(reroute+"/fetchBanks",function(e){$.each(e,function(e,t){$(".bankSelect").each(function(){$(this).find("option[value="+t.id+"]").length||$(this).append($("<option></option>").val(t.id).html(t.BankName))})})})),editableNumber(paymentItem),$(".PTeditable").editable({send:"never",type:"text",validate:function(e){return""==$.trim(e)?"This field is required":""==$.isNumeric(e)||0==e?"Please input a valid number greater than 0":void 0},emptytext:0,display:function(e){$(this).text(Number(e).toFixed(2)),PTcalcCost()}}),dateEditable(paymentItem),paymentItem++}function removePT(e){if($("#PT"+e).remove(),e+=1,$("#PT"+e).length)for(;itemno>e;)$("#PT"+e).attr("id","PT"+(e-1)),$("#removePT"+e).attr("id","removePT"+(e-1)),$("#removePT"+(e-1)).attr("onclick","removePT("+(e-1)+")"),e++;paymentItem-=1,PTcalcCost()}function PTcalcCost(){var e=0;$(".PTcost").each(function(){e+=parseFloat($(this).text())}),$("#paymentTypeTotal").text(Number(e).toFixed(2))}function vwBillcalcCost(){var e=0;$(".vwBillcost").each(function(){e+=parseFloat($(this).text())}),$("#vwBillSPTotalCost").text(Number(e).toFixed(2))}function editCategory(e){$("#modalCatError").addClass("hidden");var t=$(".category").DataTable(),a=jQuery.trim($("#catName"+e).text()),l=t.row("#category"+e).index();$("#catID").val(e),$("#catIndex").val(l),$("#txtCatName").val(a),$("#myModal").modal("show"),$(".modal-title").text("Edit "+a)}function editSupplier(e){$(".supplier").DataTable();$(".modal-title").text("Edit Supplier"),$("#supplierModal").modal("show"),$.post(reroute+"/fetchSupplier",{id:e},function(e){$("#txtSupID").val(e.id),$("#SupplierName").val(e.SupplierName),$("#Address").val(e.Address),$("#Telephone1").val(e.Telephone1),$("#Telephone2").val(e.Telephone2),$("#ContactPerson").val(e.ContactPerson)})}function editProduct(e){$(".product").DataTable();$(".modal-title").text("Edit Product"),$("#productModal").modal("show"),$.post(reroute+"/fetchProduct",{id:e},function(e){$("#txtProdID").val(e.id),$("#ProductCatNo").val(e.ProductCatNo),$("#ProductName").val(e.ProductName),$("#BrandName").val(e.BrandName),$("#WholeSaleUnit").val(e.WholeSaleUnit),$("#RetailUnit").val(e.RetailUnit),$("#RetailQtyPerWholeSaleUnit").val(e.RetailQtyPerWholeSaleUnit),$("#Reorderpoint").val(e.Reorderpoint),$("#Markup1").val(e.Markup1),$("#Markup2").val(e.Markup2),$("#Markup3").val(e.Markup3),$("#ActiveMarkup").val(e.ActiveMarkup)})}function numberOnlyInput(e){-1!==$.inArray(e.keyCode,[46,8,9,27,13,110,190])||65==e.keyCode&&e.ctrlKey===!0||e.keyCode>=35&&e.keyCode<=39||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}$(function(){$.ajaxSetup({headers:{"X-CSRF-Token":$('meta[name="_token"]').attr("content")}});var e=window.location.hash;e&&$('ul.nav a[href="'+e+'"]').tab("show")});var reroute="/user/"+$('meta[name="_token"]').attr("content"),itemno=1,counter=1,d=new Date;$(document).ready(function(){$(".add-user").click(function(){$('#userForm input[type="text"]').val("")}),$("#user-library").on("hidden.bs.modal",function(){$(".user-pwd,.password,.retype-password").show(),$(".password,.retype-password").attr("required")}),$("#invoiceDate").datepicker(),$("#edTerm,#vwSupplier").change(function(){$("#vwSavePOBtn").removeClass("hidden")}),$("#edTerm1").click(function(){$("#vwSavePOBtn").removeClass("hidden")}),$("#vwApproved").change(function(){var e=$("#edPOId").text();if($("#vwApproved").is(":checked"))var t=1;else var t=0;$.post(reroute+"/approvePO",{id:e,ApprovedBy:t},function(t){t?($("#edApprovedBy").val(t),$("#App"+e).text(t),$("#App"+e).parent("tr").removeClass("warning"),$("#App"+e).parent("tr").addClass("success")):($("#edApprovedBy").val("N/A"),$("#App"+e).text("N/A"),$("#App"+e).parent("tr").removeClass("success"),$("#App"+e).parent("tr").addClass("warning"))})}),$("#billApproved").change(function(){var e=$("#vwSaveBillBtn").val();if($("#billApproved").is(":checked"))var t=1;else var t=0;$.post(reroute+"/approveBill",{id:e,ApprovedBy:t},function(t){t?($("#AppBill"+e).text(t),$("#AppBill"+e).parent("tr").removeClass("warning"),$("#AppBill"+e).parent("tr").addClass("success")):($("#AppBill"+e).text("N/A"),$("#AppBill"+e).parent("tr").removeClass("success"),$("#AppBill"+e).parent("tr").addClass("warning"))})}),$("#SIApproved").change(function(){var e=$("#vwSaveSIBtn").val();if($("#SIApproved").is(":checked"))var t=1;else var t=0;$.post(reroute+"/approveSI",{id:e,ApprovedBy:t},function(t){t?($("#App"+e).text(t),$("#App"+e).parent("tr").removeClass("warning"),$("#App"+e).parent("tr").addClass("success")):($("#App"+e).text("N/A"),$("#App"+e).parent("tr").removeClass("success"),$("#App"+e).parent("tr").addClass("warning"))})}),$("#POCancelBtn").click(function(){var e=$("#edPOId").text();$.post(reroute+"/cancelPO",{id:e},function(t){$("#CancelledBy"+e).text(t),location.reload(),"Purchase"==document.title&&$(location).attr("href","/PurchaseOrders#showPOList")})}),$("#BillCancelBtn").click(function(){var e=$("#vwSaveBillBtn").val();alert(e),$.post(reroute+"/cancelBill",{id:e},function(){location.reload(),"Bills"==document.title&&$(location).attr("href","/Bills#BillsList")})}),$("#SICancelBtn").click(function(){var e=$("#vwSaveSIBtn").val();$.post(reroute+"/cancelSI",{id:e},function(){location.reload(),"Invoice"==document.title&&$(location).attr("href","/SalesInvoice#showSIList")})}),$("#current-password").blur(function(){var e=$(this).val();$.get(reroute+"verifyCurrentPassword",{val:e},function(e){"0"==e?($("#isCurrentPW").val("0"),$(".alert").show()):($("#isCurrentPW").val("1"),$(".alert").hide())})}),$.fn.editable.defaults.mode="inline",$(".pops").popover({trigger:"hover"}),$(".add-customer").click(function(){$("#library-action").val(""),$(".name").val(""),$(".address").val(""),$(".telephone1").val(""),$(".telephone2").val(""),$(".contact-person").val(""),$(".credit-limit").val(""),$(".delete").hide()}),$(".add-branch").click(function(){$("#library-action").val(""),$(".name").val(""),$(".address").val(""),$(".telephone").val(""),$(".delete").hide()}),$(".add-bank").click(function(){$("#library-action").val(""),$(".name").val(""),$(".address").val(""),$(".telephone").val(""),$(".delete").hide()});var e=document.title;document.getElementsByTagName("body")[0].id=e,$("ul.nav li.dropdown").hover(function(){$(".dropdown-menu",this).fadeIn()},function(){$(".dropdown-menu",this).fadeOut("fast")}),$("#SB"+e).addClass("active"),$("#SB"+e+" a:contains("+e+")").parent().addClass("active"),$("#SB"+e).parent().parent().removeClass("collapse"),$("#sidebar-wrapper").hover(function(e){e.preventDefault(),$("#wrapper").addClass("toggled")},function(){$("#wrapper").removeClass("toggled")}),$("#ProductCategory").keyup(function(){$("#catError").addClass("hidden")
}),$("#saveCategory").click(function(e){e.preventDefault();var t=jQuery.trim($("#ProductCategory").val());if(t&&0!=t.length){var a=$(".category").dataTable();$.post(reroute+"/addCategory",{ProdCatName:t},function(e){if(0==e)$("#catError").text("Category already exists!"),$("#catError").removeClass("hidden");else{var t=a.fnAddData([e.updated_at,e.ProdCatName,'<button class="btn btn-success btn-xs" onclick="editCategory('+e.id+');"><i class="fa fa-cog"></i> Edit</button>']),l=a.fnSettings().aoData[t[0]].nTr;l.setAttribute("id","category"+e.id),$("#category"+e.id+" td:nth-child(1)").attr("id","catName"+e.id),$("#catError").addClass("hidden")}})}else $("#catError").text("Category text field is empty!"),$("#catError").removeClass("hidden");$("#ProductCategory").val(" ")}),$("#categoryBtn").click(function(){var e=$(".category").DataTable(),t=$("#catID").val(),a=$("#catIndex").val(),l=$("#txtCatName").val(),d=jQuery.trim($("#txtCatName").val());d&&0!=d.length?$.post(reroute+"/editCategory",{id:t,ProdCatName:l},function(t){0==t?($("#modalCatError").text("Category already exists!"),$("#modalCatError").removeClass("hidden")):(e.cell(a,1).data(t).draw(),$("#myModal").modal("hide"))}):($("#modalCatError").text("Text field is empty!"),$("#modalCatError").removeClass("hidden"))}),$("#addSupplier").click(function(){$(".modal-title").text("Add new Supplier"),$("#txtSupID").val(null),$("input[type=text]").val(null),$("#supplierModal").modal("show")}),$("#addProduct").click(function(){$(".modal-title").text("Add new Product"),$("#txtProdID").val(null),$("input[type=text]").val(null),$("#productModal").modal("show")}),$(".sidehead").click(function(){$(this).children("ul").first().stop(!0,!0).slideToggle(500)}),$("#telephone,#telephone1,#telephone2").keydown(function(e){e.shiftKey||(e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)?8!=e.keyCode&&9!=e.keyCode&&107!=e.keyCode&&187!=e.keyCode&&116!=e.keyCode&&16!=e.keyCode&&109!=e.keyCode&&189!=e.keyCode&&($(".alert").show(),e.preventDefault()):$(".alert").hide()}),$("#term2,#edTerm2,#billTerm2").click(function(){$("#termBox,#edTermBox,#billTermBox").removeClass("hidden"),$("#term1,#edTerm1,#billTerm1").removeClass("active"),$("#term,#edTerm,#billTerm").select()}),$("#term1,#edTerm1,#billTerm1").click(function(){$("#termBox,#edTermBox,#billTermBox").addClass("hidden"),$("#term2,#edTerm2,#billTerm2").removeClass("active"),$("#term,#edTerm,#billTerm").val(0)}),$("#term,#edTerm,#billTerm").blur(function(){var e=jQuery.trim($(this).val());""==e&&$(this).val(0)}),$("#term,#edTerm,#billTerm,#invoiceno").keydown(function(e){numberOnlyInput(e)}),$(".numberOnly").keydown(function(e){numberOnlyInput(e)}),$("#addProductPO").click(function(){$("#addProductPOModal").modal("show")}),$("#savePO").click(function(){function e(){var e=new Array;return $(".POtable tr").each(function(t,a){e[t]={ProdNo:$(a).find("td:eq(1)").text(),Unit:$(a).find("td:eq(4)").text(),Qty:$(a).find("td:eq(5)").text(),CostPerQty:$(a).find("td:eq(6)").text()}}),e.shift(),e}var t,a=$("#supplier").val(),l=$("#term").val(),d=$("#preparedBy").text();if($("#approved").is(":checked"))var o=d;else var o="";t=e(),t=$.toJSON(t),$.post(reroute+"/savePO",{TD:t,supplier:a,term:l,preparedBy:d,approvedBy:o},function(e){1==e?(location.reload(),$("#successModal").modal("show"),$(location).attr("href","/PurchaseOrders#showPOList")):0==e&&$("#savePOError").fadeIn("fast",function(){$("#savePOError").fadeOut(4e3)})})}),$("#vwSavePOBtn").click(function(){function e(){var e=new Array;return $(".edPOTable tr").each(function(t,a){e[t]={ProdNo:$(a).find("td:eq(1)").text(),Unit:$(a).find("td:eq(4)").text(),Qty:$(a).find("td:eq(5)").text(),CostPerQty:$(a).find("td:eq(6)").text()}}),e.shift(),e}var t,a=$("#edPOId").text(),l=$('[name="vwSupplier"]').val(),d=$("#edTerm").val();t=e(),t=$.toJSON(t),$.post(reroute+"/saveEditedPO",{TD:t,supplier:l,term:d,id:a},function(e){1==e?(location.reload(),"Purchase"==document.title&&$(location).attr("href","/PurchaseOrders#showPOList")):0==e&&alert("invalid move")})}),$("#saveBillPOBtn").click(function(){function e(){var e=new Array;return $(".BillPOTable > tbody  > tr").each(function(t,a){e[t]={ProductNo:$(a).find("td:eq(1)").text(),Unit:$(a).find("td:eq(4)").text(),LotNo:$(a).find("td:eq(5)").text(),ExpiryDate:$(a).find("td:eq(6)").text(),Qty:$(a).find("td:eq(7)").text(),CostPerQty:$(a).find("td:eq(8)").text(),FreebiesQty:$(a).find("td:eq(10)").text(),FreebiesUnit:$(a).find("td:eq(11)").text()}}),e}var t,a=$("#billPOId").text(),l=$("#billTerm").val(),d=$("#invoiceno").val(),o=$("#invoicedate").val();if($("#billApprove").is(":checked"))var i=1;else var i="";t=e(),t=$.toJSON(t),$.post(reroute+"/savePOBill",{TD:t,term:l,id:a,SalesInvoiceNo:d,SalesInvoiceDate:o,ApprovedBy:i},function(e){1==e?(location.reload(),"Purchase"==document.title&&$(location).attr("href","/PurchaseOrders#showPOList")):0==e&&$("#billError").fadeIn("fast",function(){$("#billError").fadeOut(4e3)})})}),$("#vwSaveBillBtn").click(function(){function e(){var e=new Array;return $(".BillPOTable > tbody  > tr").each(function(t,a){e[t]={ProductNo:$(a).find("td:eq(1)").text(),Unit:$(a).find("td:eq(4)").text(),LotNo:$(a).find("td:eq(5)").text(),ExpiryDate:$(a).find("td:eq(6)").text(),Qty:$(a).find("td:eq(7)").text(),CostPerQty:$(a).find("td:eq(8)").text(),FreebiesQty:$(a).find("td:eq(10)").text(),FreebiesUnit:$(a).find("td:eq(11)").text()}}),e}var t,a=$("#vwSaveBillBtn").val(),l=$("#billTerm").val(),d=$("#invoiceno").val(),o=$("#invoicedate").val();t=e(),t=$.toJSON(t),$.post(reroute+"/saveEditedPOBill",{TD:t,term:l,id:a,SalesInvoiceNo:d,SalesInvoiceDate:o},function(e){1==e?(location.reload(),"Purchase_Orders"==document.title&&$(location).attr("href","/PurchaseOrders#showPOList")):0==e&&$("#billError").fadeIn("fast",function(){$("#billError").fadeOut(4e3)})})}),$("#saveBillSOBtn").click(function(){function e(){var e=new Array;return $(".BillSOTable > tbody  > tr").each(function(t,a){e[t]={ProductNo:$(a).find("td:eq(1)").text(),Unit:$(a).find("td:eq(4)").text(),LotNo:$(a).find("td:eq(5)").text(),ExpiryDate:$(a).find("td:eq(6)").text(),Qty:$(a).find("td:eq(7)").text(),CostPerQty:$(a).find("td:eq(8)").text(),FreebiesQty:$(a).find("td:eq(10)").text(),FreebiesUnit:$(a).find("td:eq(11)").text()}}),e}var t,a=$("#billSOId").text(),l=$("#billTerm").val(),d=$("#invoiceno").val(),o=$("#invoicedate").val();if($("#billApprove").is(":checked"))var i=1;else var i="";t=e(),t=$.toJSON(t),$.post(reroute+"/saveSOBill",{TD:t,term:l,id:a,RefDocNo:d,SalesInvoiceDate:o,ApprovedBy:i},function(e){1==e?(location.reload(),"Invoice"==document.title&&$(location).attr("href","/SalesInvoice#showSIList")):0==e&&$("#billError").fadeIn("fast",function(){$("#billError").fadeOut(4e3)})})}),$("#vwSaveSIBtn").click(function(){function e(){var e=new Array;return $(".BillSOTable > tbody  > tr").each(function(t,a){e[t]={ProductNo:$(a).find("td:eq(1)").text(),Unit:$(a).find("td:eq(4)").text(),LotNo:$(a).find("td:eq(5)").text(),ExpiryDate:$(a).find("td:eq(6)").text(),Qty:$(a).find("td:eq(7)").text(),CostPerQty:$(a).find("td:eq(8)").text(),FreebiesQty:$(a).find("td:eq(10)").text(),FreebiesUnit:$(a).find("td:eq(11)").text()}}),e}var t,a=$("#vwSaveSIBtn").val(),l=$("#billTerm").val(),d=$("#invoiceno").val(),o=$("#invoicedate").val();t=e(),t=$.toJSON(t),$.post(reroute+"/saveEditedSI",{TD:t,term:l,id:a,RefDocNo:d,SalesInvoiceDate:o},function(e){1==e?(location.reload(),"Invoice"==document.title&&$(location).attr("href","/SalesInvoice#showSIList")):0==e&&$("#billError").fadeIn("fast",function(){$("#billError").fadeOut(4e3)})})}),$("#billCheque").click(function(){$(".chequeDiv").removeClass("hidden"),$(".cashDiv").addClass("hidden");var e;$(".BillPaymentTable > tbody > tr").each(function(t,a){e=$(a).find("td:eq(2)").text()}),$("#payTo").val(e)}),$("#billCash").click(function(){$(".cashDiv").removeClass("hidden"),$(".chequeDiv").addClass("hidden")}),$("#cashVoucher").click(function(){var e;$("#cashVoucherTable > tbody > tr").remove(),$(".BillPaymentTable > tbody > tr").each(function(t,a){e=$(a).find("td:eq(2)").text(),$("#cashVoucherTable").append('<tr>\n							<td colspan="7">Bill No '+$(a).find("td:eq(1)").text()+'</td>\n							<td class="dp"><i style="padding-right:8%;">'+$(a).find("td:eq(4)").text()+"</i></td>\n							</tr>")}),$(".cashVoucherTotal").text($("#BillPaymentTotalCost").text());var t=toWords(Number($("#BillPaymentTotalCost").text()).toFixed(0));$("#cvReceivedFrom").text(e),$("#wordVoucherTotal").text(t),$("#cashVoucherModal").modal("show"),$("#cashVoucherPrintable").printThis({debug:!1,importCSS:!0,printContainer:!0,pageTitle:"Cash Voucher",removeInline:!1,printDelay:333,header:null,formValues:!0})}),$("#chequeVoucher").click(function(){if(!$("#chequeNo").val().length||!$("#chequeDueDate").val().length||!$("#payTo").val().length)return $("#chequeError").fadeIn("fast",function(){$("#chequeError").fadeOut(4e3)}),void 0;$("#checkVoucherCheckNo").text($("#chequeNo").val()),$("#checkVoucherBank").text($("#bankNo").find("option:selected").text()),$("#checkVoucherDueDate").text($("#chequeDueDate").val()),$("#checkVoucherPayTo").text($("#payTo").val()),$("#checkVoucherTable > tbody > tr").remove(),$(".BillPaymentTable > tbody > tr").each(function(e,t){$("#checkVoucherTable").append('<tr>\n							<td colspan="7">Bill No '+$(t).find("td:eq(1)").text()+'</td>\n							<td class="dp"><i style="padding-right:8%;">'+$(t).find("td:eq(4)").text()+"</i></td>\n							</tr>")}),$(".checkVoucherTotal").text($("#BillPaymentTotalCost").text());toWords(Number($("#BillPaymentTotalCost").text()).toFixed(0));$("#checkVoucherModal").modal("show")}),$("#saveBill").click(function(){function e(){var e=new Array;return $(".BillPaymentTable > tbody  > tr").each(function(t,a){e[t]={BillNo:$(a).find("td:eq(1)").text(),amount:$(a).find("td:eq(4)").text()}}),e}var t,a=$("#BPediting").val();t=e(),t=$.toJSON(t);var l=$("#BillPaymentTotalCost").text();if($("#billCash").is(":checked"))var d=0,o=$("#cashVoucherNo").text();else if($("#billCheque").is(":checked")){if(!$("#chequeNo").val().length||!$("#chequeDueDate").val().length||!$("#payTo").val().length)return $("#chequeError").fadeIn("fast",function(){$("#chequeError").fadeOut(4e3)}),void 0;var d=1,i=$("#chequeVaucherNo").text(),n=$("#chequeNo").val(),r=$("#chequeDueDate").val(),s=$("#bankNo").find("option:selected").val(),c=$("#payTo").val()}if($("#approvedBillPayment").is(":checked"))var v=1;else var v=0;$.post(reroute+"/billPayment",{id:a,TD:t,amount:l,type:d,cashVoucherNo:o,checkNo:n,checkVoucherNo:i,checkDueDate:r,BankNo:s,approved:v,PayTo:c},function(){location.reload(),$(location).attr("href","/BillPayments#BillPaymentList")})}),$(".editBillPayment").click(function(){var e=$(this).val(),t=1;$("#BPediting").val(e),$(".BillPaymentTable >tbody > tr").remove(),$.post(reroute+"/getbillPayments",{id:e},function(e){if($(".billPaymentEditId").text(e.id),0==e.PaymentType)$(".cashDiv").removeClass("hidden"),$(".chequeDiv").addClass("hidden"),$("#billCash").prop("checked",!0),$("#cashVoucherNo").text(e.CashVoucherNo);else if(1==e.PaymentType){$(".chequeDiv").removeClass("hidden"),$(".cashDiv").addClass("hidden"),$("#bankNo").val(e.BankNo),$("#billCheque").prop("checked",!0),$("#chequeNo").val(e.CheckNo),$("#payTo").val(e.PayTo);var t=new Date(e.CheckDueDate);$("#chequeDueDate").val(t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear())}e.ApprovedBy?$("#approvedBillPayment").prop("checked",!0):$("#approvedBillPayment").prop("checked",!1)}),$.post(reroute+"/getbillPaymentDetails",{id:e},function(e){$.each(e,function(e,a){$(".BillPaymentTable").append('<tr id="bill'+t+'"><td id="billitemno'+t+'">'+t+'</td><td id="billId'+a.BillNo+'">'+a.BillNo+'</td>\n				<td class="supplier'+a.SupplierNo+'">'+a.SupplierName+'</td><td class="dp">'+a.InvoiceNo+'</td><td class="dp Billcost">'+money(a.Amount)+'</td><td>\n				<button class="btn btn-danger btn-xs square" id="removeBill'+t+'" onclick="removeBill('+t+')">\n				<i class="fa fa-times"></i> Remove</button></td></tr>'),t+=1,calcBillPaymentTotal()})}),$("#saveBill,.cashChecque").removeClass("hidden"),$("#BillPaymentEditing").removeClass("hidden"),$('#myTab a[href="#BillPaymentEntry"]').tab("show")}),$("#cancelBPEditing").click(function(){location.reload()}),$("#SPCheck").click(function(){$("#SPCheck").is(":checked")?($(".chequeDiv").removeClass("hidden"),$("#SPCash").is(":checked")&&$(".cashDiv").removeClass("hidden")):$(".chequeDiv").addClass("hidden")}),$("#SPCash").click(function(){$("#SPCash").is(":checked")?$(".cashDiv").removeClass("hidden"):$(".cashDiv").addClass("hidden")}),$("#saveSP").click(function(){function e(){var e=new Array;return $(".BillPaymentTable > tbody  > tr").each(function(t,a){e[t]={invoiceNo:$(a).find("td:eq(1)").text(),amount:$(a).find("td:eq(5)").text()}}),e}function t(){var e=new Array;return $("#cashCheckTable > tbody  > tr").each(function(t,a){"Cash"==$(a).find("td:eq(0)").text()?e[t]={PaymentType:$(a).find("td:eq(0)").text(),amount:$(a).find("td:eq(1)").text()}:"Check"==$(a).find("td:eq(0)").text()&&(e[t]={PaymentType:$(a).find("td:eq(0)").text(),BankNo:$(a).find(".bankSelect ").find("option:selected").val(),CheckNo:$(a).find("td:eq(2)").text(),CheckDueDate:$(a).find("td:eq(3)").text(),amount:$(a).find("td:eq(4)").text()})}),e}var a,l=$("#SPediting").val(),d=$("#customer_id").val(),o=0;a=e(),a=$.toJSON(a),PaymentTypes=t(),PaymentTypes=$.toJSON(PaymentTypes);$("#BillPaymentTotalCost").text();if($("#approvedSP").is(":checked"))var i=1;else var i=0;$.post(reroute+"/salesPay",{id:l,customerNo:d,TD:a,PT:PaymentTypes,advance:o,customer_id:d,approved:i},function(){location.reload(),$(location).attr("href","/SalesPayment#SalesPaymentList")})}),$(".editSP").click(function(){var e,t=$(this).val(),a=1;$("#SPediting").val(t),$("#cashCheckTable > tbody > tr").remove(),PTcalcCost(),$(".BillPaymentTable >tbody > tr").remove(),$("#invoicesTfoot").remove(),$.post(reroute+"/getSP",{id:t},function(e){$(".billPaymentEditId").text(e.id),e.ApprovedBy?$("#approvedSP").prop("checked",!0):$("#approvedSP").prop("checked",!1)}),$("#SPCash,#SPCheck,.cashDiv,.clearEdit").prop("checked",!1),$(".clearEdit").val(""),$(".cashDiv").addClass("hidden"),$.post(reroute+"/getSPDetails",{id:t},function(e){$.each(e,function(e,t){if(0==t.PaymentType&&($("#SPCash").prop("checked",!0),$(".cashDiv").removeClass("hidden"),$("#cashAmount").val(money(t.amount))),1==t.PaymentType){$("#SPCheck").prop("checked",!0),$("#chequeNo").val(t.CheckNo);var a=new Date(t.CheckDueDate);$("#chequeDueDate").val(a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()),$("#bankNo").val(t.BankNo),$("#checkAmount").val(money(t.amount)),$(".chequeDiv").removeClass("hidden")}})}),$.post(reroute+"/getSPInvoices",{id:t},function(l){$.each(l,function(t,l){$(".BillPaymentTable").append('<tr id="bill'+a+'"><td id="billitemno'+a+'">'+a+'</td><td id="billId'+l.invoiceNo+'">'+l.invoiceNo+'</td>\n				<td class="customer'+l.CustomerNo+'">'+l.CustomerName+'</td><td class="medrep'+l.UserNo+'">'+l.Lastname+", "+l.Firstname+" "+l.MI+'.<td class="dp">'+l.SalesInvoiceRefDocNo+'</td><td class="dp Billcost">'+money(l.amount)+'</td>\n				<td><button class="btn btn-danger btn-xs square" id="removeBill'+a+'" onclick="removeBill('+a+')">\n				<i class="fa fa-times"></i> Remove</button></td></tr>'),a+=1,calcBillPaymentTotal(),e=l.CustomerNo,$("#customer_id").val(l.CustomerNo)}),$.post(reroute+"/getBal",{id:t},function(e){0>e?$(".BillPaymentTable").append('<tfoot id="invoicesTfoot"><tr><td colspan="5"></td><td class="dp Balcost">'+money(-1*e)+"</td><td>Balance</td></tr></tfoot>"):e>0&&$(".BillPaymentTable").append('<tfoot id="invoicesTfoot"><tr><td colspan="5"></td><td class="dp Balcost">'+money(-1*e)+"</td><td>Advanced Payment</td></tr></tfoot>"),calcBillPaymentTotal()}),e=$("#customer_id").val(),$.post(reroute+"/checkPayments",{customer_id:e},function(e){e>0?($(".BillPaymentTable").append('<tfoot id="invoicesTfoot"><tr><td colspan="5">Balance</td><td class="dp Balcost">'+money(e)+"</td><td></td></tr></tfoot>"),calcBillPaymentTotal()):0>e&&($(".BillPaymentTable").append('<tfoot id="invoicesTfoot"><tr><td colspan="5">Advanced Payment</td><td class="dp Balcost">'+money(e)+"</td><td></td></tr></tfoot>"),calcBillPaymentTotal())})}),$.post(reroute+"/getPaymentTypes",{id:t},function(e){if(e.length){var t=1;$.each(e,function(e,a){if(0==a.PaymentType&&$("#cashCheckTable").append('<tr id="PT'+t+'">\n						<td colspan="4">Cash</td>\n						<td class="PTeditable danger PTcost">'+a.amount+'</td>\n						<td><button class="btn btn-danger btn-xs square" id="removePT'+t+'" onclick="removePT('+t+')">\n						<i class="fa fa-times"></i> Remove</button></td></tr>'),1==a.PaymentType){$("#cashCheckTable").append('<tr id="PT'+t+'">\n						<td>Check</td>\n						<td><select class="bankSelect form-control square" id="bankSelect'+t+'"></select></td><td class="numberEditable danger">'+a.CheckNo+'</td>\n						<td class="dateEditable danger">'+a.CheckDueDate+'</td>\n						<td class="PTeditable danger PTcost">'+a.amount+'</td>\n						<td><button class="btn btn-danger btn-xs square" id="removePT'+t+'" onclick="removePT('+t+')">\n						<i class="fa fa-times"></i> Remove</button></td></tr>');var l=a.BankNo;$("#bankSelect"+t).append($("<option></option>").val(l).html(l).attr("selected",!0)),$.post(reroute+"/fetchBanks",function(e){$(".bankSelect").each(function(){$.each(e,function(e,t){$(".bankSelect").find("option[value="+t.id+"]").length?($(".bankSelect").find("option[value="+t.id+"]").html(t.BankName),$(".bankSelect").each(function(){$(this).find("option[value="+t.id+"]").length||$(this).append($("<option></option>").val(t.id).html(t.BankName))})):$(".bankSelect").append($("<option></option>").val(t.id).html(t.BankName))})})})}editableNumber(t),$(".PTeditable").editable({send:"never",type:"text",validate:function(e){return""==$.trim(e)?"This field is required":""==$.isNumeric(e)||0==e?"Please input a valid number greater than 0":void 0},emptytext:0,display:function(e){$(this).text(Number(e).toFixed(2)),PTcalcCost()}}),dateEditable(t),t++})}}),$("#saveSP,.cashChecque").removeClass("hidden"),$("#BillPaymentEditing").removeClass("hidden"),$('#myTab a[href="#SalesPaymentEntry"]').tab("show")})});var paymentItem=1;