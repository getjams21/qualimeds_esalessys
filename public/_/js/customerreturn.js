function addCR(t){var e=$(".product").DataTable(),d=e.row("#rowProd"+t).index();$("#SalesInvoiceNo").val(t),$.post(reroute+"/fetchSIItems",{id:t},function(e){if(e){$(".CRTable").find("tr").remove().end();var i;$.each(e,function(e,n){i=parseInt(n.Qty),$(".CRTable").append('\n					<tr id="SO'+itemno+'">\n						<td id="itemno'+itemno+'">'+itemno+'</td>\n						<td id="prdoNo'+n.ProductNo+'">'+n.ProductNo+'</td>\n						<td id="prodName'+n.id+'">'+n.ProductName+'</td>\n						<td id="brand'+n.id+'">'+n.BrandName+'</td>\n						<td id="lotNo'+t+'">'+n.LotNo+'</td>\n						<td id="expDate'+t+'">'+n.ExpiryDate+'</td>\n						<td id="unit'+t+'">'+n.Unit+'</td>\n						<td class="light-green editable" id="prodQtySO'+n.id+'" value="'+n.Qty+'">'+n.Qty+'</td>\n						<td id="prodUntSO'+n.id+'">'+money(n.UnitPrice)+'</td>\n						<td class="cost" id="prodCostSO'+n.id+'">0.00</td>\n						<td id="freebiesQty'+n.id+'">'+parseInt(n.FreebiesQty)+'</td>\n						<td id="freebiesQty'+n.id+'">'+n.FreebiesUnit+'</td>\n						<td><button class="btn btn-danger btn-xs square" id="removeIA'+n.id+'" onclick="removeIA('+itemno+","+t+","+d+')">\n						<i class="fa fa-times"></i> Remove</button></td>\n						<input type="hidden" id="prevQty'+n.id+'" value="'+i+'">\n					</tr>\n				'),itemno+=1,$(".editable").editable({send:"never",type:"text",value:i,validate:function(t){return""==$.trim(t)?"This field is required":""==$.isNumeric(t)||0==t?"Please input a valid number greater than 0":void 0},emptytext:0,display:function(t){$(this).text(t);var e=$(this).attr("id").substring(9);calcCostSO(e,i)}}),$("#saveSO").removeClass("hidden")})}})}function addVwCR(t){var e=$(".vwproduct").DataTable(),d=e.row("#rowProd"+t).index();$("#SalesInvoiceNo").val(t),$.post(reroute+"/fetchSIItems",{id:t},function(e){if(e){$(".vwCRTable").find("tr").remove().end();var i;$.each(e,function(e,n){i=parseInt(n.Qty),$(".vwCRTable").append('\n					<tr id="SO'+itemno+'">\n						<td id="itemno'+itemno+'">'+itemno+'</td>\n						<td id="prdoNo'+n.ProductNo+'">'+n.ProductNo+'</td>\n						<td id="prodName'+n.id+'">'+n.ProductName+'</td>\n						<td id="brand'+n.id+'">'+n.BrandName+'</td>\n						<td id="lotNo'+t+'">'+n.LotNo+'</td>\n						<td id="expDate'+t+'">'+n.ExpiryDate+'</td>\n						<td id="unit'+t+'">'+n.Unit+'</td>\n						<td class="light-green editable" id="prodQtySO'+n.id+'" value="'+n.Qty+'">'+n.Qty+'</td>\n						<td id="prodUntSO'+n.id+'">'+money(n.UnitPrice)+'</td>\n						<td class="cost" id="prodCostSO'+n.id+'">0.00</td>\n						<td id="freebiesQty'+n.id+'">'+parseInt(n.FreebiesQty)+'</td>\n						<td id="freebiesQty'+n.id+'">'+n.FreebiesUnit+'</td>\n						<td><button class="btn btn-danger btn-xs square" id="removeIA'+n.id+'" onclick="removeIA('+itemno+","+t+","+d+')">\n						<i class="fa fa-times"></i> Remove</button></td>\n						<input type="hidden" id="prevQty'+n.id+'" value="'+i+'">\n					</tr>\n				'),itemno+=1,$(".editable").editable({send:"never",type:"text",value:i,validate:function(t){return""==$.trim(t)?"This field is required":""==$.isNumeric(t)||0==t?"Please input a valid number greater than 0":void 0},emptytext:0,display:function(t){$(this).text(t);var e=$(this).attr("id").substring(9);calcCostSO(e,i)}}),$("#vwSaveSOBtn").removeClass("hidden")})}})}function calcCostSO(t){var e=parseInt($("#prodQtySO"+t).text()),d=parseInt($("#prevQty"+t).val());if(e>d)return $("#invalidQty").show(),$("#saveSO").attr("disabled","disabled"),!1;$("#saveSO").removeAttr("disabled"),$("#invalidQty").hide();var i=parseFloat($("#prodUntSO"+t).text()).toFixed(2);$("#prodCostSO"+t).text(parseFloat(e*i).toFixed(2)),totalCostSO()}function totalCostSO(){var t=0;$(".cost").each(function(){t+=parseFloat($(this).text())}),$("#SOTotalCost").text(t.toFixed(2)),(t=0)&&$("#saveSO").addClass("hidden")}function removeIA(t,e,d){var i=$(".product").DataTable();if($("#SO"+t).remove(),t+=1,$("#SO"+t).length)for(;itemno>t;)$("#SO"+t).attr("id","SO"+(t-1)),$("#itemno"+t).attr("id","itemno"+(t-1)),$("#itemno"+(t-1)).text(t-1),$("#productId"+t).attr("id","productId"+(t-1)),$("#removeSO"+t).attr("id","removeSO"+(t-1)),e=$("#productId"+(t-1)).text(),d=i.row("#rowProd"+e).index(),$("#removeSO"+(t-1)).attr("onclick","removeSO("+(t-1)+","+e+","+d+")"),t++;itemno-=1,totalCostSO()}function viewPO(t){$("#viewPOModal").modal("show"),$.post("/viewPO",{id:t},function(t){$("#vwPOId").text(t[0].id),$("#vwPODate").text(t[0].PODate),$("#vwSupplier").val(t[0].SupplierNo),"0"==t[0].Terms?$("#vwTerm").val("Cash"):$("#vwTerm").val(t[0].Terms),$("#vwPreparedBy").val(t[0].PreparedBy),""==t[0].ApprovedBy?$("#vwApprovedBy").val("N/A"):$("#vwApprovedBy").val(t[0].ApprovedBy)}),$.post("/viewPODetails",{id:t},function(t){$(".vwPOTable > tbody").html(""),counter=1;var e=0;$.each(t,function(t,d){$(".vwPOTable >tbody").append("<tr ><td>"+counter+"</td><td>"+d.ProductNo+"</td>\n	  					<td>"+d.ProductName+"</td>\n	  					<td>"+d.BrandName+"</td><td>"+d.Unit+"</td><td>"+d.Qty+"</td><td>"+d.UnitPrice+"</td>\n	  					<td>"+d.UnitPrice*d.Qty+"</td></tr>"),counter+=1,e+=d.UnitPrice*d.Qty}),$("#vwTotalCost").text(e)})}function editCR(t){$("#vwSaveBtn").addClass("hidden"),$("#editCRModal").modal("show");var e;$.post(reroute+"/viewCR",{id:t},function(t){e=t.SalesinvoiceNo,$("#edCRId").text(t.id),$("#edCRDate").text(t.CustomerReturnDate),$("#remarks").text(t.Remarks),$("#edPreparedBy").val(t.PreparedBy),""==t.ApprovedBy?$("#edApprovedBy").val("N/A"):$("#edApprovedBy").val(t.ApprovedBy),$.post(reroute+"/fetchSI",{SIno:e},function(t){if(t){$("#vwSItable").find("tr").remove().end(),$("#vwSalesInvoiceNo").val(t.id),$("#vwCustomer").val(t.CustomerNo);var e;e=0==t.Terms?"Cash":"Check",$("#vwSItable").append('\n					<tr id="rowProd'+t.id+'">\n                      <td id="si'+t.id+'">'+t.id+'</td>\n                      <td id="invoice'+t.id+'">'+t.SalesInvoiceRefDocNo+'</td>\n                      <td id="SO'+t.id+'">'+t.SalesOrderNo+'</td>\n                      <td id="invoiceDate'+t.id+'">'+t.InvoiceDate+'</td>\n                      <td id="terms'+t.id+'">'+e+'</td>\n                      <td id="prepared'+t.id+'">'+t.PreparedBy+'</td>\n                      <td id="approved'+t.id+'">'+t.ApprovedBy+'</td>\n                      <td><button class="btn btn-success btn-xs square" onclick="addVwCR('+t.id+')" ><i class="fa fa-check-circle"></i> Add</button>\n                      </td>\n                    </tr>\n				')}})}),$.post(reroute+"/viewCRDetails",{id:t},function(e){function i(t){var e=$("#edQty"+t).text(),d=$("#edUnt"+t).text();$("#edCost"+t).text(money(parseFloat(e*d))),n()}function n(){var t=0;$(".cost").each(function(){t+=parseFloat($(this).text())}),$("#edSOTotalCost").text(money(parseFloat(t))),0==t?$("#vwSaveSOBtn").addClass("hidden"):$("#vwSaveSOBtn").removeClass("hidden")}$(".edSOTable > tbody").html(""),counter=1;var o=0;$.each(e,function(e,n){var a=parseFloat(n.UnitPrice)*parseFloat(n.Qty);$(".edSOTable >tbody").append('<tr id="vwPO'+counter+'"><td id="vwItemno'+counter+'">'+counter+'</td><td id="vwProd'+n.ProductNo+'">'+n.ProductNo+"</td>\n	  					<td>"+n.ProductName+"</td>\n	  					<td>"+n.BrandName+'</td>\n	  					<td  id="lotNo'+t+'"><i>'+n.LotNo+"</i></td>\n						<td>"+n.ExpiryDate+"</td>\n	  					<td>"+n.Unit+'</td>\n	  					<td class="light-green vweditable" id="edQty'+counter+'">'+parseInt(n.Qty)+'</td>\n	  					<td id="edUnt'+counter+'">'+money(n.UnitPrice)+'</td>\n	  					<td class="cost"id="edCost'+counter+'">'+a.toFixed(2)+'</td>\n	  					<td id="edUnt'+counter+'">'+parseInt(n.FreebiesQty)+'</td>\n	  					<td id="edUnt'+counter+'">'+n.FreebiesUnit+'</td>\n	  					<td><button class="btn btn-danger \n	  					btn-xs square dis" id="vwRemovePO'+counter+'" onclick="vwRemovePO('+counter+')" >\n						<i class="fa fa-times" ></i> Remove</button></td></tr>'),o+=n.UnitPrice*n.Qty,counter+=1,$(".editable-default").editable({send:"never",type:"text",value:n.LotNo,validate:function(t){return""==$.trim(t)?"This field is required":void 0},emptytext:0,display:function(t){$(this).text(t)}}),$(".dateEditable").editable({type:"combodate",format:"YYYY-MM-DD",viewformat:"YYYY-MM-DD",template:"D / MMMM / YYYY",validate:function(t){return""==$.trim(t)?"This field is required":void 0},combodate:{minYear:d.getFullYear(),maxYear:d.getFullYear()+10,minuteStep:1}}),$(".vweditable").editable({send:"never",type:"text",validate:function(t){return""==$.trim(t)?"This field is required":""==$.isNumeric(t)||0==t?"Please input a valid number greater than 0":void 0},emptytext:0,display:function(t){$(this).text(t);var e=$(this).attr("id").substring(5);i(e)}})})})}function vwaddIA(t){var e=$("#name"+t).text(),i=$("#brand"+t).text(),n=$("#wholesale"+t).text(),o=$(".product").DataTable(),a=0,r=o.row("#rowProd"+t).index(),s=new Date;$(".edSOTable").append('<tr id="SO'+itemno+'"><td id="itemno'+itemno+'">'+itemno+'</td>\n		<td id="prdoNo'+itemno+'">'+t+"</td>\n		<td>"+e+"</td>\n		<td>"+i+'</td>\n		<td class="editable-default" id="lotNo'+t+'"><i></i></td>\n		<td class="dateEditable">'+s.getFullYear()+"-"+s.getMonth()+"-"+s.getDate()+'\n		</td>\n		<td><select class="form-control square" name="unit" id="unit'+itemno+'">\n                  <option value="'+n+'">'+n+'</option>\n                  <option value="pcs">pcs</option>\n                </select></td>\n		<td class="light-green editable" id="prodQtySO'+itemno+'" value="'+itemno+'">1</td>\n		<td class="light-red ed" id="prodUntSO'+itemno+'">0.00</td>\n		<td class="cost" id="prodCostSO'+itemno+'">0.00</td>\n		<td><button class="btn btn-danger btn-xs square" id="removeIA'+itemno+'" onclick="removeIA('+itemno+","+t+","+r+')">\n		<i class="fa fa-times"></i> Remove</button></td></tr>'),itemno+=1,$(".editable-default").editable({send:"never",type:"text",value:1,validate:function(t){return""==$.trim(t)?"This field is required":void 0},emptytext:0,display:function(t){$(this).text(t)}}),$(".dateEditable").editable({type:"combodate",format:"YYYY-MM-DD",viewformat:"YYYY-MM-DD",template:"D / MMMM / YYYY",validate:function(t){return""==$.trim(t)?"This field is required":void 0},combodate:{minYear:d.getFullYear(),maxYear:d.getFullYear()+10,minuteStep:1}}),$(".editable").editable({send:"never",type:"text",value:1,validate:function(t){return""==$.trim(t)?"This field is required":""==$.isNumeric(t)||0==t?"Please input a valid number greater than 0":void 0},emptytext:0,display:function(t){$(this).text(t);var e=$(this).attr("id").substring(9);edcalcCostSO(e)}}),$(".ed").editable({send:"never",type:"text",value:a,validate:function(t){return""==$.trim(t)?"This field is required":""==$.isNumeric(t)||0==t?"Please input a valid number greater than 0":void 0},emptytext:0,display:function(t){$(this).text(t);var e=$(this).attr("id").substring(9);edcalcCostSO(e)}}),$("#vwSaveSOBtn").removeClass("hidden")}function edcalcCostSO(t){var e=parseInt($("#prodQtySO"+t).text()),d=parseFloat($("#prodUntSO"+t).text()).toFixed(2);$("#prodCostSO"+t).text(parseFloat(e*d).toFixed(2)),edtotalCostSO()}function edtotalCostSO(){var t=0;$(".cost").each(function(){t+=parseFloat($(this).text())}),$("#edSOTotalCost").text(money(parseFloat(t))),(t=0)&&$("#vwSaveSOBtn").addClass("hidden")}function vwRemovePO(t){if($("#vwPO"+t).remove(),t+=1,$("#vwPO"+t).length)for(;$("#vwPO"+t).length;)$("#vwPO"+t).attr("id","vwPO"+(t-1)),$("#vwItemno"+t).attr("id","vwItemno"+(t-1)),$("#vwItemno"+(t-1)).text(t-1),$("#vwRemovePO"+t).attr("id","vwRemovePO"+(t-1)),$("#vwRemovePO"+(t-1)).attr("onclick","vwRemovePO("+(t-1)+")"),t++;counter-=1,edtotalCost(),$("#vwSaveSOBtn").removeClass("hidden")}var reroute="/user/"+$('meta[name="_token"]').attr("content"),sample="sample",itemno=1,counter=1;$(document).ready(function(){$("#customer").on("change",function(){var t=$(this).val();$.post(reroute+"/fetchCustomerSI",{id:t},function(t){if(t){$("#SITable").find("tr").remove().end();var e;$.each(t,function(t,d){e=0==d.Terms?"Cash":"Check",$("#SITable").append('\n						<tr id="rowProd'+d.id+'">\n	                      <td id="si'+d.id+'">'+d.id+'</td>\n	                      <td id="invoice'+d.id+'">'+d.SalesInvoiceRefDocNo+'</td>\n	                      <td id="SO'+d.id+'">'+d.SalesOrderNo+'</td>\n	                      <td id="invoiceDate'+d.id+'">'+d.InvoiceDate+'</td>\n	                      <td id="terms'+d.id+'">'+e+'</td>\n	                      <td id="prepared'+d.id+'">'+d.PreparedBy+'</td>\n	                      <td id="approved'+d.id+'">'+d.ApprovedBy+'</td>\n	                      <td><button class="btn btn-success btn-xs square" onclick="addCR('+d.id+')" ><i class="fa fa-check-circle"></i> Add</button>\n	                      </td>\n	                    </tr>\n					')})}})}),$("#addProductPO").click(function(){$("#addProductPOModal").modal("show")}),$("#saveSO").click(function(){function t(){var t=new Array,e=1;return $(".IAtable tr").each(function(d,i){t[d]={ProdNo:$(i).find("td:eq(1)").text(),LotNo:$(i).find("td:eq(4)").text(),ExpiryDate:$(i).find("td:eq(5)").text(),Unit:$(i).find("td:eq(6)").text(),Qty:$(i).find("td:eq(7)").text(),UnitPrice:$(i).find("td:eq(8)").text(),FreebiesQty:$(i).find("td:eq(10)").text(),FreebiesUnit:$(i).find("td:eq(11)").text()},e++}),t.shift(),t}var e,d=$("#SalesInvoiceNo").val(),i=$("#customer").val(),n=$("#remarks").val();e=t(),e=$.toJSON(e);var o=$("#preparedBy").text();if($("#approved").is(":checked"))var a=o;else var a="";$.post(reroute+"/saveCR",{TD:e,CustomerNo:i,SalesinvoiceNo:d,Remarks:n,PreparedBy:o,approvedBy:a},function(t){1==t?(location.reload(),$(location).attr("href","/customer-return#showCRList")):0==t&&$("#savePOError").fadeIn("fast",function(){$("#savePOError").fadeOut(4e3)})})}),$("#vwSaveSOBtn").click(function(){function t(){var t=new Array,e=1;return $(".edSOTable tr").each(function(d,i){t[d]={ProdNo:$(i).find("td:eq(1)").text(),LotNo:$(i).find("td:eq(4)").text(),ExpiryDate:$(i).find("td:eq(5)").text(),Unit:$(i).find("td:eq(6)").text(),Qty:$(i).find("td:eq(7)").text(),UnitPrice:$(i).find("td:eq(8)").text(),FreebiesQty:$(i).find("td:eq(10)").text(),FreebiesUnit:$(i).find("td:eq(11)").text()},e++}),t.shift(),t}var e,d=$("#vwSalesInvoiceNo").val(),i=$("#vwCustomer").val(),n=$("#edCRId").text(),o=$("#remarks").val();e=t(),e=$.toJSON(e);var a=$("#preparedBy").text();if($("#approved").is(":checked"))var r=a;else var r="";$.post(reroute+"/saveEditedCR",{TD:e,CustomerNo:i,SalesinvoiceNo:d,Remarks:o,PreparedBy:a,approvedBy:r,id:n},function(t){1==t?(location.reload(),$(location).attr("href","/customer-return#showCRList")):0==t&&$("#savePOError").fadeIn("fast",function(){$("#savePOError").fadeOut(4e3)})})}),$("#td-remarks").hover(function(){$(this).popover("show")},function(){$(this).popover("hide")})});